CREATE DATABASE IF NOT EXISTS FLEXBACK_db
CHARACTER SET = utf8mb4
  COLLATE = utf8mb4_unicode_ci;
USE FLEXBACK_db;

CREATE TABLE TAIKHOAN (
  maTaiKhoan INT NOT NULL AUTO_INCREMENT,
  tenTaiKhoan VARCHAR(50),
  matKhau VARCHAR(255),
  hoVaTen VARCHAR(100),
  ngaySinh DATE,
  gioiTinh VARCHAR(5),
  soDienThoai VARCHAR(10),
  email VARCHAR(100),
  diaChi TEXT,
  loaiTaiKhoan VARCHAR(20),
  ngayTaoTaiKhoan DATETIME DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (maTaiKhoan)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE NHOM_CO (
  maNhomCo INT NOT NULL AUTO_INCREMENT,
  tenNhomCo VARCHAR(100),
  moTaNhomCo TEXT,
  PRIMARY KEY (maNhomCo)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE BAITAP_PHUCHOI (
  maBaiTap INT NOT NULL AUTO_INCREMENT,
  maNhomCo INT,
  tenBaiTap VARCHAR(100),
  moTaBaiTap TEXT,
  mucDo VARCHAR(50),
  dungCuCanThiet VARCHAR(50),
  videoHuongDan VARCHAR(255),
  PRIMARY KEY (maBaiTap),
  CONSTRAINT fk_baitap_nhomco FOREIGN KEY (maNhomCo) REFERENCES NHOM_CO(maNhomCo)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE BENHNHAN (
  maBenhNhan INT NOT NULL AUTO_INCREMENT,
  chieuCao DECIMAL(5,2),
  canNang DECIMAL(5,2),
  tienSuChanThuong TEXT,
  tinhTrangHienTai TEXT,
  maTaiKhoan INT,
  PRIMARY KEY (maBenhNhan),
  CONSTRAINT fk_benhnhan_taikhoan FOREIGN KEY (maTaiKhoan) REFERENCES TAIKHOAN(maTaiKhoan)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE BACSI (
  maBacSi INT NOT NULL AUTO_INCREMENT,
  chuyenKhoa VARCHAR(100),
  congTac VARCHAR(100),
  ngayBatDau DATE,
  maTaiKhoan INT,
  PRIMARY KEY (maBacSi),
  CONSTRAINT fk_bacsi_taikhoan FOREIGN KEY (maTaiKhoan) REFERENCES TAIKHOAN(maTaiKhoan)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE KYTHUATVIEN (
  maKyThuatVien INT NOT NULL AUTO_INCREMENT,
  chungChi TEXT,
  ngayBatDau DATE,
  maTaiKhoan INT,
  PRIMARY KEY (maKyThuatVien),
  CONSTRAINT fk_kythuatvien_taikhoan FOREIGN KEY (maTaiKhoan) REFERENCES TAIKHOAN(maTaiKhoan)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE HOSOSO_BENHAN (
  maHoSo INT NOT NULL AUTO_INCREMENT,
  maBenhNhan INT,
  maBacSi INT,
  ngayLapHoSo DATE,
  chanDoan TEXT,
  trangThaiHienTai VARCHAR(50),
  PRIMARY KEY (maHoSo),
  CONSTRAINT fk_hososo_benhnhan FOREIGN KEY (maBenhNhan) REFERENCES BENHNHAN(maBenhNhan)
    ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT fk_hososo_bacsi FOREIGN KEY (maBacSi) REFERENCES BACSI(maBacSi)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE THONGBAO_LICHTAP (
  maLichTap INT NOT NULL AUTO_INCREMENT,
  maHoSo INT,
  maTaiKhoan INT,
  ngayTap DATE,
  gioBatDau TIME,
  trangThai VARCHAR(20),
  daDoc TINYINT(1) DEFAULT 0,
  phuongThuc VARCHAR(20),
  ghiChu TEXT,
  PRIMARY KEY (maLichTap),
  CONSTRAINT fk_lichtap_hoso FOREIGN KEY (maHoSo) REFERENCES HOSOSO_BENHAN(maHoSo)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_lichtap_taikhoan FOREIGN KEY (maTaiKhoan) REFERENCES TAIKHOAN(maTaiKhoan)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE PHANCONG (
  maPhanCong INT NOT NULL AUTO_INCREMENT,
  maHoSo INT,
  maKyThuatVien INT,
  ngayBatDau DATE,
  ngayKetThuc DATE,
  PRIMARY KEY (maPhanCong),
  CONSTRAINT fk_phancong_hoso FOREIGN KEY (maHoSo) REFERENCES HOSOSO_BENHAN(maHoSo)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_phancong_kythuatvien FOREIGN KEY (maKyThuatVien) REFERENCES KYTHUATVIEN(maKyThuatVien)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE MUCTIEU_DIEUTRI (
  maMucTieu INT NOT NULL AUTO_INCREMENT,
  maHoSo INT,
  noiDung TEXT,
  trangThai VARCHAR(20),
  ngayDatMucTieu DATE,
  PRIMARY KEY (maMucTieu),
  CONSTRAINT fk_muctieu_hoso FOREIGN KEY (maHoSo) REFERENCES HOSOSO_BENHAN(maHoSo)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE LOTRINH_DIEUTRI (
  maLoTrinh INT NOT NULL AUTO_INCREMENT,
  maMucTieu INT,
  maKyThuatVien INT,
  tenLoTrinh VARCHAR(100),
  thoiGianBatDau DATE,
  thoiGianKetThuc DATE,
  ghiChu TEXT,
  PRIMARY KEY (maLoTrinh),
  CONSTRAINT fk_lotrinh_muctieu FOREIGN KEY (maMucTieu) REFERENCES MUCTIEU_DIEUTRI(maMucTieu)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_lotrinh_kythuatvien FOREIGN KEY (maKyThuatVien) REFERENCES KYTHUATVIEN(maKyThuatVien)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE KEHOACH_DIEUTRI (
  maKeHoach INT NOT NULL AUTO_INCREMENT,
  maLoTrinh INT,
  tenKeHoach VARCHAR(100),
  moTa TEXT,
  thoiGianBatDau DATE,
  thoiGianKetThuc DATE,
  PRIMARY KEY (maKeHoach),
  CONSTRAINT fk_kehoach_lotrinh FOREIGN KEY (maLoTrinh) REFERENCES LOTRINH_DIEUTRI(maLoTrinh)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE CHITIET_KEHOACH (
  maChiTiet INT NOT NULL AUTO_INCREMENT,
  maKeHoach INT,
  maBaiTap INT,
  sets INT,
  reps INT,
  cuongDo VARCHAR(20),
  ghiChu TEXT,
  PRIMARY KEY (maChiTiet),
  CONSTRAINT fk_chitietkehoach_kehoach FOREIGN KEY (maKeHoach) REFERENCES KEHOACH_DIEUTRI(maKeHoach)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_chitietkehoach_baitap FOREIGN KEY (maBaiTap) REFERENCES BAITAP_PHUCHOI(maBaiTap)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE BAOCAO_LUYENTAP (
  maBaoCao INT NOT NULL AUTO_INCREMENT,
  maKeHoach INT,
  ngayLuyenTap DATE,
  thoiLuong INT,
  mucDoDau INT,
  danhGiaSoBo TEXT,
  PRIMARY KEY (maBaoCao),
  CONSTRAINT fk_baocao_kehoach FOREIGN KEY (maKeHoach) REFERENCES KEHOACH_DIEUTRI(maKeHoach)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE DANHGIA_TIENTRIEN (
  maDanhGia INT NOT NULL AUTO_INCREMENT,
  maHoSo INT,
  ngayDanhGia DATE,
  chiTiet TEXT,
  thangDiem DECIMAL(4,2),
  PRIMARY KEY (maDanhGia),
  CONSTRAINT fk_danhgia_hoso FOREIGN KEY (maHoSo) REFERENCES HOSOSO_BENHAN(maHoSo)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE CANMANG_THUOC (
  maThuoc INT NOT NULL AUTO_INCREMENT,
  tenThuoc VARCHAR(100),
  congDung TEXT,
  PRIMARY KEY (maThuoc)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE CANMANG_THUCPHAM (
  maThucPham INT NOT NULL AUTO_INCREMENT,
  tenThucPham VARCHAR(100),
  chiTiet TEXT,
  PRIMARY KEY (maThucPham)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE CHITIET_SUDUNG (
  maSuDung INT NOT NULL AUTO_INCREMENT,
  maHoSo INT,
  loai VARCHAR(20),
  maThuoc INT,
  maThucPham INT,
  lieuLuong TEXT,
  huongDanSuDung TEXT,
  PRIMARY KEY (maSuDung),
  CONSTRAINT fk_chitietsudung_hoso FOREIGN KEY (maHoSo) REFERENCES HOSOSO_BENHAN(maHoSo)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_chitietsudung_thuoc FOREIGN KEY (maThuoc) REFERENCES CANMANG_THUOC(maThuoc)
    ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT fk_chitietsudung_thucpham FOREIGN KEY (maThucPham) REFERENCES CANMANG_THUCPHAM(maThucPham)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;